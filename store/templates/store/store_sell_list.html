{% extends "store/layout.html" %}
{% load trade_tags %}

{% block store_content %}

<div class="container-fluid text-center">
    <div class="row">
    {% for item in items %}
        <div class="col-sm-6 col-md-3 col-xs-12" style="padding:10px">
            {% if request.user == stores.user %}
                <div id="item-{{ item.id }}" class="edit" href="#" data-form="{% url "trade:item_update" item.pk %}" title="Edit">
                    {% item_block item %}
                </div>
                <!-- Modal -->
                <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"></div>
            {% else %}
                {% item_block item %}
            {% endif %}
        </div>
    {% empty %}
        <h4 class="text-center"><i class="far fa-tired"></i>판매 물품이 없습니다</h4>

    {% endfor %}

    </div>
</div>


<div class="container-fluid text-center">
{% if is_paginated %}
  <nav>
    <ul class="pagination">
      {% if page_obj.has_previous %}
        <li>
          <a href="?query={{ query }}&sort={{ sort }}&page={{ page_obj.previous_page_number }}">
            <span>Prev</span>
          </a>
        </li>
      {% else %}
        <li class="disabled">
          <a href="#">
            <span>Previous</span>
          </a>
        </li>
      {% endif %}

      {% for page in page_range %}
        <li {% if page == page_obj.number %}class="active"{% endif %}>
          <a href="?query={{ query }}&sort={{ sort }}&page={{ page }}">{{ page }}</a>
        </li>
      {% endfor %}

      {% if page_obj.has_next %}
        <li>
          <a href="?query={{ query }}&sort={{ sort }}&page={{ page_obj.next_page_number }}">
            <span>Next</span>
          </a>
        </li>
      {% else %}
        <li {% if not page_obj.has_next %}class="disabled"{% endif %}>
          <a href="#">
            <span>Next</span>
          </a>
        </li>
      {% endif %}
    </ul>
  </nav>
{% endif %}
</div>


{% endblock %}


{% block store_extra_content %}
<script>
    var edit_url = '';

    $(".edit").click(function(ev) { // for each edit contact url
        ev.preventDefault(); // prevent navigation
        edit_url = $(this).data("form"); // get the contact form url
        $("#modal").load(edit_url, function() { // load the url into the modal
            $(this).modal("show"); // display the modal on url load
        });
        return false; // prevent the click propagation
    });

    function editSubmit(){
        var params = jQuery("#edit-form").serialize();
        $.ajax({
            type: 'POST',
            url: edit_url,
            data: params,
            success: function(data) {
                if (data.pay_status == '재고있음'){
                    html = '<i class="far fa-handshake"></i> <span style="color:blue;"><b>'+data.pay_status+'</b></span>'
                }
                else{
                    html = '<i class="far fa-handshake"></i> <span style="color:red;"><b>'+data.pay_status+'</b></span>'
                }
                $('#item-'+data.id).find('.pay-status').html(html);
            }
        });
        return false;
    }
</script>
{% endblock %}